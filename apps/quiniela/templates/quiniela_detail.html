{% extends "base_main.html" %}

{# Load the tag library #}
{% load bootstrap3 %}
{% load tz %}
{% load quiniela_tournamenttags %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block content-header %}
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
        <li><a href="{% url 'main:home' %}">Home</a></li>
        <li class="active">Quinielas</li>
    </ol>
    <h1> {{ user.username }} </h1>
{% endblock %}

{% block content %}
    {% if quiniela %}
        <h3> 
            {% if quiniela.image %}
                <img src="{{quiniela.image.url}}" width="50px" height="auto">
            {% endif %}
            {{ quiniela.name }} - 
            {% if quiniela.tournament.image %}
                <img src="{{quiniela.tournament.image.url}}" width="50px" height="auto">
            {% endif %}
            {{ quiniela.tournament.name }}
        </h3>
        <h5>{{ quiniela.description }}<br>
            {{ quiniela.tournament.description }}<br>
        </h5>
        {% if user.profile == quiniela.admin %}
        <button type="button" class="btn btn-danger" onclick="quiniela_delete()">Delete {{ quiniela.name }}</button>
        {% endif  %}
        <button type="button" class="btn btn-success" onclick="show_invite_form()">
          <i class="fa fa-plus"></i> Invite User/s
        </button><br><br>
        <form role="form" method="post" id="formsets">
        {% csrf_token %}
          <div class="invite-form-container" style="display: none">
              {{ invite_formset.management_form }}
              <table>
                  {{ invite_formset }}
              </table>
              Introduce one or more users usernames or emails separated by ';' to invite them! (test;test@testmail.com)<br>
              <button type="button" class="btn" onclick="show_invite_form()">
                <i class="fa fa-plus"></i> Invite
              </button><br>
          </div>
          <hr>

          <ul class="nav nav-tabs">
            <li><a data-toggle="tab" href="#leaderboard">Leaderboard & Table</a></li>
            <li class="active"><a data-toggle="tab" href="#group1">Group Matchday 1</a></li>
            <li><a data-toggle="tab" href="#group2">Group Matchday 2</a></li>
            <li><a data-toggle="tab" href="#group3">Group Matchday 3</a></li>
            <li><a data-toggle="tab" href="#eights">Eights</a></li>
            <li><a data-toggle="tab" href="#quarters">Quarter Finals</a></li>
            <li><a data-toggle="tab" href="#semifinal">Semi Final</a></li>
            <li><a data-toggle="tab" href="#third">Third Place</a></li>
            <li><a data-toggle="tab" href="#final">Final</a></li>
          </ul>
          <div class="tab-content">
              <br>
              <div id="leaderboard" class="row container-fluid tab-pane fade in">
                  <div class="col-sm-4" align="center">
                    {% if quiniela.image %}
                        <img src="{{quiniela.image.url}}" width="50px" height="auto">
                    {% endif %}
                    <b>{{ quiniela.name }} - LeaderBoard:</b><br><br>
                    <div class="row">
                      <div class="col-xs-12">
                        {% for leader in leaders %}
                          {{ leader }} - {% get_score leader quiniela.score_type %}<br>
                        {% endfor %}
                        {% for pending in pendings %}
                          {{ pending }} - pending<br>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-8">
                    <div align="center">
                      {% if quiniela.tournament.image %}
                          <img src="{{quiniela.tournament.image.url}}" width="50px" height="auto">
                      {% endif %}
                      <b>{{ quiniela.tournament.name }} - Groups Table</b>
                    </div>
                    <div class="row">
                      {% for group in groups %}
                      <div class="col-sm-6">
                        <div class="col-xs-12" align="center"> <b>{{ group }}</b></div>
                        {% for team in group.get_teams %}
                        <div class="row">
                          <div class="col-xs-4 col-xs-offset-2">
                            <img src="{{ team.team.image.url }}" width="48" height="34">{{ team.team.name }}
                          </div>
                          <div class="col-xs-6" align="center">
                            {{ team.get_score }}
                          </div>
                        </div>
                        {% endfor %}
                        <br>
                      </div>
                      {% endfor %}
                    </div>
                  </div>
              </div>

              {% for group_matchday_pair in group_predictions %}
              <div id="group{{ forloop.counter }}" class="row container-fluid tab-pane fade in active">
                <div class="col-sm-6">
                  <div align="center"><b>Your Predictions - Group Matchday {{ forloop.counter }}</b></div><br><br>
                  {{ group_matchday_pair.1 }}
                  {% for pair in group_matchday_pair.0 %}
                      {% if forloop.counter0|divisibleby:2 %}
                      <div class="row">
                      {% endif %}

                          <div class="col-sm-6">
                              {% bootstrap_messages %}
                              {{ pair.1.errors }}
                              {% for hidden_field in pair.1.hidden_fields %}
                                  {{ hidden_field }}
                              {% endfor %}
                              <div class="row">
                                  <div class="col-xs-6 no-padding-right">
                                      <div class="col-xs-6 no-padding-right" align="right">
                                          <img src="{{ pair.0.home_team.image.url }}" width="48px" height="34px">
                                      </div>
                                      <div class="col-xs-6">
                                          {% bootstrap_field pair.1.score_home size='sm' label=pair.0.home_team.name layout='inline' %}
                                      </div>
                                  </div>
                                  <div class="col-xs-6 no-padding-left">
                                      <div class="col-xs-6">
                                          {% bootstrap_field pair.1.score_away size='sm' label=pair.0.away_team.name layout='inline' %}
                                      </div>
                                      <div class="col-xs-6 no-padding-left">
                                          <img src="{{ pair.0.away_team.image.url }}" width="48px" height="34px">
                                      </div>
                                  </div>
                                  <div class="col-xs-12" align="center">
                                      {% if not pair.0.score_set %}
                                        <b>?</b>
                                      {% else %}
                                        {% if pair.1.score_home.value == pair.0.score_home and pair.1.score_away.value == pair.0.score_away %}
                                          <i class="fa fa-check" style="color:green"></i>
                                        {% elif pair.1.score_home.value == pair.0.score_home %}
                                        <i class="fa fa-check" style="color:green"></i> <i class="fa fa-close" style="color:red"></i>
                                        {% elif pair.1.score_away.value == pair.0.score_away %}
                                        <i class="fa fa-close" style="color:red"></i> <i class="fa fa-check" style="color:green"></i>
                                        {% else %}
                                          <i class="fa fa-close" style="color:red"></i>
                                        {% endif %}
                                      {% endif %}
                                  </div>
                              </div>
                          </div>

                      {% if not forloop.counter0|divisibleby:2 %}
                      </div>
                      <br>
                      {% endif %}
                  {% endfor %}
                  {% if not group_matchday_pair.0|length|divisibleby:2 %}
                      <br>
                      </div>
                  {% endif %}
                      <div class="col-xs-12">
                          <div class="col-xs-12">
                              <div class="col-xs-12">
                                <button type="button" class="btn" onclick="submit_form('formsets')">
                                  Send
                                </button>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="col-sm-6">
                  <div align="center"><b>Official Results - Group Matchday {{ forloop.counter }}</b></div><br><br>
                      {% for pair in group_matchday_pair.0 %}
                          {% if forloop.counter0|divisibleby:2 %}
                          <div class="row">
                          {% endif %}

                              <div class="col-sm-6">                        
                                  {{ pair.0.home_team.name }} 
                                  <img src="{{ pair.0.home_team.image.url }}" width="46px" height="33px"> 
                                  {% if pair.0.score_set %} {{ pair.0.score_home }} {% endif %} -  
                                  {% if pair.0.score_set %} {{ pair.0.score_away }} {% endif %}
                                  <img src="{{ pair.0.away_team.image.url }}" width="46px" height="33px">
                                  {{ pair.0.away_team.name }}<br>
                                  {{ pair.0.match_datetime|date:"D d M" }} {{ pair.0.match_datetime|time:"H:i" }}
                                  {% get_current_timezone as TIME_ZONE %} ({{ TIME_ZONE }})
                              </div>

                          {% if not forloop.counter0|divisibleby:2 %}
                          </div>
                          <br>
                          {% endif %}
                      {% endfor %}
                      {% if not group_matchday_pair.0|length|divisibleby:2 %}
                      </div>
                      {% endif %}
                  </div>
              </div>
              {% endfor %}

              <div id="eights" class="row container-fluid tab-pane fade in">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
              </div>

              <div id="quarters" class="row container-fluid tab-pane fade in">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
              </div>

              <div id="semifinal" class="row container-fluid tab-pane fade in">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
              </div>

              <div id="third" class="row container-fluid tab-pane fade in">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
              </div>

              <div id="final" class="row container-fluid tab-pane fade in">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
              </div>
          </div>
        </form>
      {% else %}
      <h3>No existe esa quiniela =(</h3>
    {% endif %}
{% endblock %}

{% block jsblock %}
<script type="text/javascript">
  var inv = false;
  function quiniela_delete() {
    r = confirm("Are you sure?");
    if(r){
      window.location.href = "{% url 'quiniela:quiniela_delete' quiniela_id=quiniela.id %}"
    }
  }

  function show_invite_form(){
    if(!inv){
      $(".invite-form-container").show();
      inv = true;
    }else{
      submit_form('formsets')
    }
  }

  function submit_form(frmId){
    my_form = document.getElementById(frmId);
    my_form.submit();
  }
</script>
{% endblock %}